import{U as le,a as ce,g as de,r as n,j as e,c as N,C as fe,A as oe,B as V,F as R,$ as je,b as y,d as E,e as T,f as U,E as K,h as Q,i as Y,k as X,l as ge,P as ee,m as se,u as ae,n as ve,o as Ne,p as be,I as Ce,q as Se,S as B,s as p,t as te,v as _e,w as we,x as ye,y as Ee,z as W,D as J,G as ne,H as re,J as Te}from"./index-jZLvl1ko.js";import{u as Ue}from"./use-post-add-user-C0ZbqQ1u.js";const Re=l=>{const{mutate:c}=le();return c(["useDeleteUsers"],async({user_id:g})=>(await ce.delete(`${de("USERS")}/${g}`)).data,l)},ke=l=>{const{mutate:c}=le();async function d({skip:g,limit:b}){const a=await ce.get(`${de("USERS")}/?skip=${g}&limit=${b}`);return a.status===200?a.data:[]}return c(["useGetUsers"],d,l)},me=n.forwardRef(({className:l,...c},d)=>e.jsx("div",{className:"",children:e.jsx("table",{ref:d,className:N("w-full caption-bottom text-sm",l),...c})}));me.displayName="Table";const ue=n.forwardRef(({className:l,...c},d)=>e.jsx("thead",{ref:d,className:N("[&_tr]:border-b",l),...c}));ue.displayName="TableHeader";const xe=n.forwardRef(({className:l,...c},d)=>e.jsx("tbody",{ref:d,className:N("[&_tr:last-child]:border-0",l),...c}));xe.displayName="TableBody";const Ae=n.forwardRef(({className:l,...c},d)=>e.jsx("tfoot",{ref:d,className:N("bg-primary font-medium text-primary-foreground",l),...c}));Ae.displayName="TableFooter";const Z=n.forwardRef(({className:l,...c},d)=>e.jsx("tr",{ref:d,className:N("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",l),...c}));Z.displayName="TableRow";const f=n.forwardRef(({className:l,...c},d)=>e.jsx("th",{ref:d,className:N("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",l),...c}));f.displayName="TableHead";const j=n.forwardRef(({className:l,...c},d)=>e.jsx("td",{ref:d,className:N("p-4 align-middle [&:has([role=checkbox])]:pr-0",l),...c}));j.displayName="TableCell";const Ie=n.forwardRef(({className:l,...c},d)=>e.jsx("caption",{ref:d,className:N("mt-4 text-sm text-muted-foreground",l),...c}));Ie.displayName="TableCaption";function ie({title:l,titleHeader:c,cancelText:d,confirmationText:_,children:g,icon:b,data:a,index:C,onConfirm:G,asChild:z}){const[v,M]=n.useState(!1),[h,H]=n.useState(!1),[m,k]=n.useState(!1),[u,A]=n.useState((a==null?void 0:a.password)??""),[S,w]=n.useState((a==null?void 0:a.username)??""),[I,D]=n.useState((a==null?void 0:a.email)??""),[x,F]=n.useState((a==null?void 0:a.password)??""),[$,P]=n.useState((a==null?void 0:a.is_active)??!1),[L,O]=n.useState((a==null?void 0:a.is_superuser)??!1),[q,s]=n.useState(fe),{userData:t}=n.useContext(oe);function r({target:{name:i,value:he}}){s(pe=>({...pe,[i]:he}))}n.useEffect(()=>{m&&(a?(w(a.username),D(a.email||""),P(a.is_active),O(a.is_superuser),r({target:{name:"username",value:S}}),r({target:{name:"email",value:I}}),r({target:{name:"is_active",value:$}}),r({target:{name:"is_superuser",value:L}})):o())},[m]);function o(){A(""),w(""),D(""),F(""),P(!1),O(!1)}return e.jsxs(V,{size:"medium-h-full",open:m,setOpen:k,children:[e.jsx(V.Trigger,{asChild:z,children:g}),e.jsxs(V.Header,{description:c,children:[e.jsx("span",{className:"pr-2",children:l}),e.jsx(R,{name:b,className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(V.Content,{children:e.jsxs(je,{onSubmit:i=>{if(u!==x){i.preventDefault();return}o(),G(1,q),k(!1),i.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs(y,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(E,{className:"data-[invalid]:label-invalid",children:["Användarnamn"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx(T,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:i}})=>{r({target:{name:"username",value:i}}),w(i)},value:S,className:"primary-input",required:!0,placeholder:"Användarnamn"})}),e.jsx(U,{match:"valueMissing",className:"field-invalid",children:"Vänligen ange ditt användarnamn"})]}),e.jsxs(y,{name:"email",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(E,{className:"data-[invalid]:label-invalid",children:["E-post"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx(T,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:i}})=>{r({target:{name:"email",value:i}}),D(i)},value:I,className:"primary-input",required:!0,type:"email",placeholder:"user@example.com"})}),e.jsx(U,{match:"valueMissing",className:"field-invalid",children:"Vänligen ange en giltig e-postadress"}),e.jsx(U,{match:"typeMismatch",className:"field-invalid",children:"Vänligen ange en giltig e-postadress"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs(y,{name:"password",serverInvalid:u!=x,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(E,{className:"data-[invalid]:label-invalid flex",children:["Lösenord"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),v&&e.jsx(K,{onClick:()=>M(!v),className:"h-5 cursor-pointer",strokeWidth:1.5}),!v&&e.jsx(Q,{onClick:()=>M(!v),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(T,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:i}})=>{r({target:{name:"password",value:i}}),A(i)},value:u,className:"primary-input",required:!a,type:v?"text":"password"})}),e.jsx(U,{className:"field-invalid",match:"valueMissing",children:"Vänligen ange ett lösenord"}),u!=x&&e.jsx(U,{className:"field-invalid",children:"Lösenorden stämmer inte överens"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs(y,{name:"confirmpassword",serverInvalid:u!=x,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(E,{className:"data-[invalid]:label-invalid flex",children:["Bekräfta lösenord"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),h&&e.jsx(K,{onClick:()=>H(!h),className:"h-5 cursor-pointer",strokeWidth:1.5}),!h&&e.jsx(Q,{onClick:()=>H(!h),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(T,{asChild:!0,children:e.jsx("input",{onChange:i=>{F(i.target.value)},value:x,className:"primary-input",required:!a,type:h?"text":"password"})}),e.jsx(U,{className:"field-invalid",match:"valueMissing",children:"Vänligen bekräfta ditt lösenord"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(y,{name:"is_active",children:e.jsxs("div",{children:[e.jsx(E,{className:"data-[invalid]:label-invalid mr-3",children:"Aktiv"}),e.jsx(T,{asChild:!0,children:e.jsx(Y,{value:$,checked:$,id:"is_active",className:"relative top-0.5",onCheckedChange:i=>{r({target:{name:"is_active",value:i}}),P(i)}})})]})}),(t==null?void 0:t.is_superuser)&&e.jsx(y,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx(E,{className:"data-[invalid]:label-invalid mr-3",children:"Superanvändare"}),e.jsx(T,{asChild:!0,children:e.jsx(Y,{checked:L,value:L,id:"is_superuser",className:"relative top-0.5",onCheckedChange:i=>{r({target:{name:"is_superuser",value:i}}),O(i)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(X,{variant:"outline",onClick:()=>{k(!1)},className:"mr-3",children:d}),e.jsx(ge,{asChild:!0,children:e.jsx(X,{className:"mt-8",children:_})})]})]})})]})}function Pe(){const[l,c]=n.useState(""),[d,_]=n.useState(ee),[g,b]=n.useState(se),a=ae(s=>s.setSuccessData),C=ae(s=>s.setErrorData),{userData:G}=n.useContext(oe),[z,v]=n.useState(0),{mutate:M}=Re(),{mutate:h}=ve(),{mutate:H}=Ue(),m=n.useRef([]);n.useEffect(()=>{setTimeout(()=>{I()},500)},[]);const[k,u]=n.useState(m.current),{mutate:A,isPending:S,isIdle:w}=ke({});function I(){A({skip:d*(g-1),limit:d},{onSuccess:s=>{v(s.total_count),m.current=s.users,u(s.users)},onError:()=>{}})}function D(s,t){_(t),b(s),A({skip:t*(s-1),limit:t},{onSuccess:r=>{v(r.total_count),m.current=r.users,u(r.users)}})}function x(){b(se),_(ee),I()}function F(s){if(c(s),s==="")u(m.current);else{const t=m.current.filter(r=>r.username.toLowerCase().includes(s.toLowerCase()));u(t)}}function $(s){M({user_id:s.id},{onSuccess:()=>{x(),a({title:Ee})},onError:t=>{C({title:ye,list:[t.response.data.detail]})}})}function P(s,t){h({user_id:s,user:t},{onSuccess:()=>{x(),a({title:J})},onError:r=>{C({title:W,list:[r.response.data.detail]})}})}function L(s,t,r){const o=ne.cloneDeep(r);o.is_active=!s,h({user_id:t,user:o},{onSuccess:()=>{x(),a({title:J})},onError:i=>{C({title:W,list:[i.response.data.detail]})}})}function O(s,t,r){const o=ne.cloneDeep(r);o.is_superuser=!s,h({user_id:t,user:o},{onSuccess:()=>{x(),a({title:J})},onError:i=>{C({title:W,list:[i.response.data.detail]})}})}function q(s){H(s,{onSuccess:t=>{h({user_id:t.id,user:{is_active:s.is_active,is_superuser:s.is_superuser}},{onSuccess:()=>{x(),a({title:Te})},onError:r=>{C({title:re,list:[r.response.data.detail]})}})},onError:t=>{C({title:re,list:[t.response.data.detail]})}})}return e.jsx(e.Fragment,{children:G&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(R,{name:"Shield",className:"w-6"}),Ne]})}),e.jsx("span",{className:"admin-page-description-text",children:be}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(Ce,{placeholder:"Sök användarnamn",value:l,onChange:s=>F(s.target.value)}),l.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{c(""),u(m.current)},children:e.jsx(R,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(R,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(ie,{title:"Ny användare",titleHeader:"Lägg till en ny användare",cancelText:"Avbryt",confirmationText:"Spara",icon:"UserPlus2",onConfirm:(s,t)=>{q(t)},asChild:!0,children:e.jsx(X,{variant:"primary",children:"Ny användare"})})})]}),S||w?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(Se,{remSize:12})}):m.current.length===0&&!w?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"Inga användare registrerade."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-fit overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(S?" border-0":""),children:e.jsxs(me,{className:"table-fixed outline-1",children:[e.jsx(ue,{className:S?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(Z,{children:[e.jsx(f,{className:"h-10",children:"Id"}),e.jsx(f,{className:"h-10",children:"Användarnamn"}),e.jsx(f,{className:"h-10",children:"E-post"}),e.jsx(f,{className:"h-10",children:"Aktiv"}),e.jsx(f,{className:"h-10",children:"Superanvändare"}),e.jsx(f,{className:"h-10",children:"Skapad"}),e.jsx(f,{className:"h-10",children:"Uppdaterad"}),e.jsx(f,{className:"h-10 w-[100px] text-right"})]})}),!S&&e.jsx(xe,{children:k.map((s,t)=>e.jsxs(Z,{children:[e.jsx(j,{className:"truncate py-2 font-medium",children:e.jsx(B,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(j,{className:"truncate py-2",children:e.jsx(B,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(j,{className:"truncate py-2",children:e.jsx(B,{content:s.email,children:e.jsx("span",{className:"cursor-default",children:s.email})})}),e.jsx(j,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(p,{size:"x-small",title:"Redigera",titleHeader:`${s.username}`,modalContentTitle:"Uppmärksamhet!",cancelText:"Avbryt",confirmationText:"Bekräfta",icon:"UserCog2",data:s,index:t,onConfirm:(r,o)=>{L(o.is_active,o.id,o)},children:[e.jsx(p.Content,{children:e.jsx("span",{children:"Är du helt säker på ändringarna du gör för denna användare?"})}),e.jsx(p.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(te,{checked:s.is_active})})})]})}),e.jsx(j,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(p,{size:"x-small",title:"Redigera",titleHeader:`${s.username}`,modalContentTitle:"Uppmärksamhet!",cancelText:"Avbryt",confirmationText:"Bekräfta",icon:"UserCog2",data:s,index:t,onConfirm:(r,o)=>{O(o.is_superuser,o.id,o)},children:[e.jsx(p.Content,{children:e.jsx("span",{children:"Är du helt säker på ändringarna du gör för denna användare?"})}),e.jsx(p.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(te,{checked:s.is_superuser})})})]})}),e.jsx(j,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(j,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(j,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(ie,{title:"Redigera",titleHeader:`${s.id}`,cancelText:"Avbryt",confirmationText:"Spara",icon:"UserPlus2",data:s,index:t,onConfirm:(r,o)=>{P(s.id,o)},children:e.jsx(B,{content:"Redigera",side:"top",children:e.jsx(R,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(p,{size:"x-small",title:"Ta bort",titleHeader:"Ta bort användare",modalContentTitle:"Uppmärksamhet!",cancelText:"Avbryt",confirmationText:"Ta bort",icon:"UserMinus2",data:s,index:t,onConfirm:(r,o)=>{$(o)},children:[e.jsx(p.Content,{children:e.jsx("span",{children:"Är du säker på att du vill ta bort denna användare? Denna åtgärd kan inte ångras."})}),e.jsx(p.Trigger,{children:e.jsx(R,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},t))})]})}),e.jsx(_e,{pageIndex:g,pageSize:d,totalRowsCount:z,paginate:D,rowsCount:we})]})]})})}export{Pe as default};

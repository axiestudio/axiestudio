import{r as a,O as te,u as L,Q as re,A as ie,j as e,$ as ne,b as v,d as N,e as V,I as C,f as m,R as I,l as le,k as f,T as R,V as _,W as de,X as K,Y as O,Z as U,_ as M,a0 as q,a1 as F,a2 as B,a3 as P,a4 as ce,a5 as oe,a as H}from"./index-jZLvl1ko.js";import{u as me}from"./use-post-add-user-C0ZbqQ1u.js";function fe(){const[$,X]=a.useState(te),[G,h]=a.useState(!0),[u,b]=a.useState({step:"signup"}),[k,Q]=a.useState(""),[g,p]=a.useState(!1),[A,j]=a.useState(""),[E,w]=a.useState(""),[d,y]=a.useState(0),{password:l,cnfPassword:c,username:S,email:D}=$;L(s=>s.setSuccessData);const T=L(s=>s.setErrorData),W=re(),{login:Y}=a.useContext(ie),{mutate:Z}=me();function x({target:{name:s,value:n}}){X(t=>({...t,[s]:n}))}a.useEffect(()=>{if(d>0){const s=setTimeout(()=>y(d-1),1e3);return()=>clearTimeout(s)}},[d]),a.useEffect(()=>{if(l!==c||l===""||c===""||S==="")return h(!0);h(!1)},[l,c,S,x]);function z(){const{username:s,password:n,email:t}=$;if(!t||!t.trim()){T({title:_,list:["E-postadress krävs"]});return}const r={username:s.trim(),email:t.trim(),password:n.trim()};Z(r,{onSuccess:i=>{de("User Signed Up",i),b({step:"verify-code",email:r.email,username:r.username}),w("✅ Konto skapat! Kontrollera din e-post för en 6-siffrig verifieringskod."),y(60)},onError:i=>{const{response:{data:{detail:o}}}=i;T({title:_,list:[o]})}})}const J=async s=>{var n,t;s.preventDefault(),p(!0),j("");try{const r=await H.post("/api/v1/email/verify-code",{email:u.email,code:k});r.data&&(r.data.access_token&&Y(r.data.access_token,"email_verification",r.data.refresh_token),b({step:"success"}),w("🎉 Konto aktiverat framgångsrikt!"),setTimeout(()=>{W("/")},2e3))}catch(r){const i=(t=(n=r.response)==null?void 0:n.data)==null?void 0:t.detail;let o="Ogiltig verifieringskod";typeof i=="object"?(o=i.message||o,i.remaining_attempts!==void 0&&(o+=` (${i.remaining_attempts} attempts remaining)`)):typeof i=="string"&&(o=i),j(o)}finally{p(!1)}},ee=async()=>{var s,n;if(!(d>0)){p(!0),j("");try{await H.post("/api/v1/email/resend-code",{email:u.email}),w("✅ Ny verifieringskod skickad!"),y(60)}catch(t){j(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.detail)||"Misslyckades att skicka om kod")}finally{p(!1)}}},se=()=>e.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-gradient-to-br from-background to-muted/30",children:e.jsxs(K,{className:"w-full max-w-md mx-auto",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-green-600"})}),e.jsx(M,{className:"text-2xl",children:"Ange Verifieringskod"}),e.jsxs(q,{children:["Vi skickade en 6-siffrig kod till",e.jsx("br",{}),e.jsx("strong",{children:u.email})]})]}),e.jsx(F,{children:e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"code",className:"block text-sm font-medium mb-2",children:"6-Siffrig Kod"}),e.jsx(C,{id:"code",type:"text",value:k,onChange:s=>Q(s.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"123456",required:!0,disabled:g,className:"text-center text-2xl tracking-widest",maxLength:6}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"⏰ Koden går ut om 10 minuter"})]}),A&&e.jsx(B,{variant:"destructive",children:e.jsx(P,{children:A})}),E&&e.jsx(B,{children:e.jsx(P,{children:E})}),e.jsx(f,{type:"submit",className:"w-full",disabled:g||k.length!==6,children:g?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"mr-2 h-4 w-4 animate-spin"}),"Verifierar..."]}):"Verifiera & Aktivera Konto"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(f,{type:"button",variant:"ghost",onClick:ee,disabled:d>0||g,className:"text-sm",children:d>0?`Skicka om om ${d}s`:"Skicka Om Kod"}),e.jsx("br",{}),e.jsxs(f,{type:"button",variant:"ghost",onClick:()=>b({step:"signup"}),className:"text-sm",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Tillbaka till Registrering"]})]})]})})]})}),ae=()=>e.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-gradient-to-br from-background to-muted/30",children:e.jsxs(K,{className:"w-full max-w-md mx-auto",children:[e.jsxs(O,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-green-600"})}),e.jsx(M,{className:"text-2xl text-green-600",children:"Välkommen till AxieStudio!"}),e.jsxs(q,{children:["Ditt konto har aktiverats framgångsrikt.",e.jsx("br",{}),"Omdirigerar till instrumentpanel..."]})]}),e.jsxs(F,{className:"text-center",children:[e.jsx("div",{className:"animate-spin mx-auto w-8 h-8 border-4 border-green-200 border-t-green-600 rounded-full mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Du kan nu komma åt alla funktioner i AxieStudio!"})]})]})});return u.step==="verify-code"?se():u.step==="success"?ae():e.jsx(ne,{onSubmit:s=>{if(l===""){s.preventDefault();return}Object.fromEntries(new FormData(s.currentTarget)),s.preventDefault()},className:"h-screen w-full",children:e.jsx("div",{className:"flex h-full w-full flex-col items-center justify-center bg-muted",children:e.jsxs("div",{className:"flex w-72 flex-col items-center justify-center gap-2",children:[e.jsx("img",{src:"/logo192.png",alt:"Axie Studio logo",className:"mb-4 h-10 w-10 scale-[1.5] rounded",onError:s=>{s.currentTarget.style.display="none",s.currentTarget.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"mb-4 h-10 w-10 scale-[1.5] bg-primary text-primary-foreground rounded flex items-center justify-center font-bold text-lg",style:{display:"none"},children:"AX"}),e.jsx("span",{className:"mb-6 text-2xl font-semibold text-primary",children:"Registrera dig för Axie Studio"}),e.jsx("div",{className:"mb-3 w-full",children:e.jsxs(v,{name:"username",children:[e.jsxs(N,{className:"data-[invalid]:label-invalid",children:["Användarnamn ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]}),e.jsx(V,{asChild:!0,children:e.jsx(C,{type:"username",onChange:({target:{value:s}})=>{x({target:{name:"username",value:s}})},value:S,className:"w-full",required:!0,placeholder:"Användarnamn"})}),e.jsx(m,{match:"valueMissing",className:"field-invalid",children:"Vänligen ange ditt användarnamn"})]})}),e.jsx("div",{className:"mb-3 w-full",children:e.jsxs(v,{name:"email",serverInvalid:!D,children:[e.jsxs(N,{className:"data-[invalid]:label-invalid",children:["Email ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]}),e.jsx(V,{asChild:!0,children:e.jsx(C,{type:"email",required:!0,onChange:({target:{value:s}})=>{x({target:{name:"email",value:s}})},value:D,className:"w-full",placeholder:"your@email.com"})}),e.jsx(m,{match:"typeMismatch",className:"field-invalid",children:"Vänligen ange en giltig e-postadress"}),e.jsx(m,{match:"valueMissing",className:"field-invalid",children:"E-postadress krävs"})]})}),e.jsx("div",{className:"mb-3 w-full",children:e.jsxs(v,{name:"password",serverInvalid:l!=c,children:[e.jsxs(N,{className:"data-[invalid]:label-invalid",children:["Lösenord ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]}),e.jsx(I,{onChange:s=>{x({target:{name:"password",value:s}})},value:l,isForm:!0,password:!0,required:!0,placeholder:"Lösenord",className:"w-full"}),e.jsx(m,{className:"field-invalid",match:"valueMissing",children:"Vänligen ange ett lösenord"}),l!=c&&e.jsx(m,{className:"field-invalid",children:"Lösenorden stämmer inte överens"})]})}),e.jsx("div",{className:"w-full",children:e.jsxs(v,{name:"confirmpassword",serverInvalid:l!=c,children:[e.jsxs(N,{className:"data-[invalid]:label-invalid",children:["Bekräfta ditt lösenord"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]}),e.jsx(I,{onChange:s=>{x({target:{name:"cnfPassword",value:s}})},value:c,isForm:!0,password:!0,required:!0,placeholder:"Bekräfta ditt lösenord",className:"w-full"}),e.jsx(m,{className:"field-invalid",match:"valueMissing",children:"Vänligen bekräfta ditt lösenord"})]})}),e.jsx("div",{className:"w-full",children:e.jsx(le,{asChild:!0,children:e.jsx(f,{disabled:G,type:"submit",className:"mr-3 mt-6 w-full",onClick:()=>{z()},children:"Registrera dig"})})}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsx(R,{to:"/login",children:e.jsxs(f,{className:"w-full",variant:"outline",children:["Har du redan ett konto? ",e.jsx("b",{children:"Logga in"})]})}),e.jsx("div",{className:"text-center",children:e.jsxs(R,{to:"/verify-email",className:"text-sm text-muted-foreground hover:text-primary",children:["Konto inte aktiverat? ",e.jsx("span",{className:"underline",children:"Klicka här"})]})})]})]})})})}export{fe as default};

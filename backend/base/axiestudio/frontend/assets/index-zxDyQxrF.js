import{a6 as Z,Q as ee,r,A as se,a as p,j as e,k as l,T as te,X as T,Y as L,_ as V,a0 as _,a1 as M,I,a2 as y,a3 as N,a4 as R,a5 as O}from"./index-jZLvl1ko.js";function ie(){const[P]=Z(),h=ee(),{login:D}=r.useContext(se),[b,j]=r.useState("loading"),[K,m]=r.useState(""),[B,F]=r.useState(!1),[o,g]=r.useState({step:"email"}),[w,$]=r.useState(""),[S,q]=r.useState(""),[c,x]=r.useState(!1),[k,u]=r.useState(""),[v,C]=r.useState(""),[d,E]=r.useState(0),A=P.get("token");r.useEffect(()=>{if(d>0){const s=setTimeout(()=>E(d-1),1e3);return()=>clearTimeout(s)}},[d]),r.useEffect(()=>{A?(g({step:"token-verify"}),W(A)):(g({step:"email"}),j("loading"))},[A]);const W=async s=>{var a,i;try{const t=await p.get(`/api/v1/email/verify?token=${s}`);t.data.verified?(j("success"),t.data.access_token&&t.data.auto_login?(D(t.data.access_token,"email_verification",t.data.refresh_token),m("E-post verifierad framgångsrikt! Du är nu inloggad. Omdirigerar till instrumentpanel..."),setTimeout(()=>{h("/")},2e3)):m("E-post verifierad framgångsrikt! Du kan nu logga in på ditt konto.")):(j("error"),m("E-postverifiering misslyckades. Vänligen försök igen."))}catch(t){j("error");const n=((i=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:i.detail)||"E-postverifiering misslyckades. Länken kan vara utgången eller ogiltig.";m(n)}},G=async()=>{var a,i;const s=prompt("Vänligen ange din e-postadress för att skicka verifiering igen:");if(s){F(!0);try{await p.post("/api/v1/email/resend-verification",{email:s}),m("Verifieringsmail skickat! Vänligen kontrollera din inkorg.")}catch(t){const n=((i=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:i.detail)||"Misslyckades att skicka verifieringsmail igen.";m(n)}finally{F(!1)}}},H=()=>{h("/login")},Q=async s=>{var a,i;s.preventDefault(),x(!0),u("");try{(await p.post("/api/v1/email/resend-code",{email:w})).data&&(g({step:"code",email:w}),C("✅ Verifieringskod skickad! Kontrollera din e-post."),E(60))}catch(t){const n=((i=(a=t.response)==null?void 0:a.data)==null?void 0:i.detail)||"Misslyckades att skicka verifieringskod";u(n)}finally{x(!1)}},X=async s=>{var a,i;s.preventDefault(),x(!0),u("");try{const t=await p.post("/api/v1/email/verify-code",{email:o.email,code:S});t.data&&(t.data.access_token&&D(t.data.access_token,"email_verification",t.data.refresh_token),g({step:"success"}),C("🎉 Konto aktiverat framgångsrikt!"),setTimeout(()=>{h("/")},2e3))}catch(t){const n=(i=(a=t.response)==null?void 0:a.data)==null?void 0:i.detail;let f="Ogiltig verifieringskod";typeof n=="object"?(f=n.message||f,n.remaining_attempts!==void 0&&(f+=` (${n.remaining_attempts} försök kvar)`)):typeof n=="string"&&(f=n),u(f)}finally{x(!1)}},Y=async()=>{var s,a;if(!(d>0)){x(!0),u("");try{await p.post("/api/v1/email/resend-code",{email:o.email}),C("✅ Ny verifieringskod skickad!"),E(60)}catch(i){u(((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.detail)||"Misslyckades att skicka om kod")}finally{x(!1)}}},z=()=>e.jsxs(T,{className:"w-full max-w-md mx-auto",children:[e.jsxs(L,{className:"text-center",children:[e.jsx("img",{src:"/logo192.png",alt:"Axie Studio logo",className:"mx-auto mb-4 w-12 h-12 rounded-full object-contain",onError:s=>{s.currentTarget.style.display="none",s.currentTarget.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-primary text-primary-foreground rounded-full items-center justify-center font-bold text-sm hidden",children:"AS"}),e.jsx(V,{className:"text-2xl",children:"Konto inte aktiverat?"}),e.jsx(_,{children:"Ange din e-postadress för att få en verifieringskod"})]}),e.jsx(M,{children:e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-2",children:"E-postadress"}),e.jsx(I,{id:"email",type:"email",value:w,onChange:s=>$(s.target.value),placeholder:"Ange din e-postadress",required:!0,disabled:c})]}),k&&e.jsx(y,{variant:"destructive",children:e.jsx(N,{children:k})}),v&&e.jsx(y,{children:e.jsx(N,{children:v})}),e.jsx(l,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Skickar kod..."]}):"Skicka verifieringskod"}),e.jsx("div",{className:"text-center",children:e.jsxs(l,{type:"button",variant:"ghost",onClick:()=>h("/login"),className:"text-sm",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Tillbaka till inloggning"]})})]})})]}),J=()=>e.jsxs(T,{className:"w-full max-w-md mx-auto",children:[e.jsxs(L,{className:"text-center",children:[e.jsx("img",{src:"/logo192.png",alt:"Axie Studio logo",className:"mx-auto mb-4 w-12 h-12 rounded-full object-contain",onError:s=>{s.currentTarget.style.display="none",s.currentTarget.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-primary text-primary-foreground rounded-full items-center justify-center font-bold text-sm hidden",children:"AS"}),e.jsx(V,{className:"text-2xl",children:"Ange verifieringskod"}),e.jsxs(_,{children:["Vi skickade en 6-siffrig kod till",e.jsx("br",{}),e.jsx("strong",{children:o.email})]})]}),e.jsx(M,{children:e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"code",className:"block text-sm font-medium mb-2",children:"6-siffrig kod"}),e.jsx(I,{id:"code",type:"text",value:S,onChange:s=>q(s.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"123456",required:!0,disabled:c,className:"text-center text-2xl tracking-widest",maxLength:6}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"⏰ Koden går ut om 10 minuter"})]}),k&&e.jsx(y,{variant:"destructive",children:e.jsx(N,{children:k})}),v&&e.jsx(y,{children:e.jsx(N,{children:v})}),e.jsx(l,{type:"submit",className:"w-full",disabled:c||S.length!==6,children:c?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Verifierar..."]}):"Verifiera & aktivera konto"}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(l,{type:"button",variant:"ghost",onClick:Y,disabled:d>0||c,className:"text-sm",children:d>0?`Skicka igen om ${d}s`:"Skicka kod igen"}),e.jsx("br",{}),e.jsxs(l,{type:"button",variant:"ghost",onClick:()=>g({step:"email"}),className:"text-sm",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Ändra e-post"]})]})]})})]}),U=()=>e.jsxs(T,{className:"w-full max-w-md mx-auto",children:[e.jsxs(L,{className:"text-center",children:[e.jsx("img",{src:"/logo192.png",alt:"Axie Studio logo",className:"mx-auto mb-4 w-12 h-12 rounded-full object-contain",onError:s=>{s.currentTarget.style.display="none",s.currentTarget.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"mx-auto mb-4 w-12 h-12 bg-primary text-primary-foreground rounded-full items-center justify-center font-bold text-sm hidden",children:"AS"}),e.jsx(V,{className:"text-2xl text-green-600",children:"Konto aktiverat!"}),e.jsxs(_,{children:["Ditt konto har aktiverats framgångsrikt.",e.jsx("br",{}),"Omdirigerar till instrumentpanel..."]})]}),e.jsxs(M,{className:"text-center",children:[e.jsx("div",{className:"animate-spin mx-auto w-8 h-8 border-4 border-green-200 border-t-green-600 rounded-full mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Du kan nu komma åt alla funktioner i AxieStudio!"})]})]});return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:"/logo192.png",alt:"Axie Studio logo",className:"mx-auto w-16 h-16 rounded-full object-contain mb-4",onError:s=>{s.currentTarget.style.display="none",s.currentTarget.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"mx-auto w-16 h-16 bg-primary text-primary-foreground rounded-full items-center justify-center mb-4 font-bold text-xl hidden",children:"AS"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AxieStudio"}),e.jsx("p",{className:"text-gray-600",children:"E-postverifiering"})]}),o.step==="email"&&z(),o.step==="code"&&J(),o.step==="success"&&U(),o.step==="token-verify"&&e.jsx("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:e.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"E-postverifiering"}),b==="loading"&&e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verifierar din e-postadress..."})]}),b==="success"&&e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full bg-green-100 p-3",children:e.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K}),e.jsx(l,{onClick:H,className:"w-full",children:"Gå till inloggning"})]}),b==="error"&&e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"rounded-full bg-red-100 p-3",children:e.jsx("svg",{className:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K}),e.jsxs("div",{className:"flex flex-col space-y-2 w-full",children:[e.jsx(l,{onClick:G,variant:"outline",className:"w-full",disabled:B,children:B?"Skickar...":"Skicka verifieringsmail igen"}),e.jsx(te,{to:"/login",className:"text-center",children:e.jsx(l,{variant:"ghost",className:"w-full",children:"Tillbaka till inloggning"})})]})]})]})}),e.jsx("div",{className:"text-center mt-6 text-sm text-gray-500",children:e.jsx("p",{children:"Behöver du hjälp? Kontakta vårt supportteam"})})]})})}export{ie as default};
